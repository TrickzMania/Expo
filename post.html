<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, collection, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";

  const firebaseConfig = { /* your config */ };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  document.getElementById("addEventForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const title = document.getElementById("title").value;
    const location = document.getElementById("location").value;
    const description = document.getElementById("description").value;
    const organizer = document.getElementById("organizer").value;
    const date = Timestamp.fromDate(new Date(document.getElementById("date").value)); // ✅ FIX
    const duration = parseInt(document.getElementById("duration").value, 10);
    const posterFile = document.getElementById("poster").files[0];

    if (!posterFile) {
      alert("Please select a poster image!");
      return;
    }

    try {
      const storageRef = ref(storage, `event_posters/${Date.now()}_${posterFile.name}`);
      await uploadBytes(storageRef, posterFile);
      const imageUrl = await getDownloadURL(storageRef);

      await addDoc(collection(db, "events"), {
        title,
        location,
        description,
        organizer,
        date,        // ✅ saved as Firestore Timestamp
        duration,
        imageUrl,
        createdAt: Timestamp.now()
      });

      alert("✅ Event added successfully!");
      window.location.href = "index.html";

    } catch (error) {
      console.error("Error adding event:", error);
      alert("❌ Failed to add event. Check console for details.");
    }
  });
</script>
